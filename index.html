<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="theme-color" content="#000000">
  <title>Installa ARTBOOMS</title>

  <meta name="description" content="Installa ARTBOOMS, il magazine online d'arte contemporanea.">
  <link rel="canonical" href="https://www.artbooms.com/">

  <!-- PWA -->
  <link rel="manifest" href="/manifest.json">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">

  <!-- Icone -->
  <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192.png">
  <link rel="apple-touch-icon" href="/icons/icon-512.png">

  <style>
    :root { --bubble-bg:#e0f0ff; --bubble-border:#000; }

    body {
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:flex-start;
      min-height:100vh;
      margin:0;
      background:#fff;
      font-family:"Times New Roman","Imperial",serif;
      color:#000;
      text-align:center;
      overflow:hidden;
    }

    /* Logo */
    #logo {
      max-width:85%;
      height:auto;
      margin-top:60px;
      margin-bottom:20px;
    }

    /* --- POPUP (fumetti) --- */
    .bubble {
      position:fixed;
      background:var(--bubble-bg);
      color:#000;
      border:1px solid var(--bubble-border);
      border-radius:14px;
      box-shadow:0 3px 10px rgba(0,0,0,.25);
      font-size:.9rem;
      line-height:1.4;
      padding:14px 20px;
      width:min(300px,80%);
      text-align:center;
      z-index:1000;
      display:none;
    }

    .bubble b { font-weight:700; }

    .bubble::after {
      content:"";
      position:absolute;
      bottom:-10px;
      left:50%;
      transform:translateX(-50%);
      border-width:10px 10px 0 10px;
      border-style:solid;
      border-color:var(--bubble-bg) transparent transparent transparent;
    }

    /* Prima nuvoletta: in basso sopra il pulsante */
    #bubble1 {
      left:50%;
      transform:translateX(-50%);
      bottom:calc(env(safe-area-inset-bottom,0px) + 112px);
    }

    /* Pulsante "Condividi" iOS (decorativo) */
    #shareButton {
      position:fixed;
      left:50%;
      transform:translateX(-50%);
      bottom:calc(env(safe-area-inset-bottom,0px) + 12px);
      width:44px;
      height:44px;
      display:none;
      z-index:1001;
      background:transparent;
      border:none;
      padding:0;
      cursor:default;
      pointer-events:none; /* NON cliccabile */
    }

    #shareButton svg {
      width:100%;
      height:100%;
      display:block;
    }

    /* Messaggio testuale centrale (nuovo) */
    #overlayHint {
      position:fixed;
      inset:0;
      background:rgba(255,255,255,0.95);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:2000;
    }

    .hint-box {
      background:var(--bubble-bg);
      color:#000;
      border:1px solid var(--bubble-border);
      border-radius:16px;
      padding:20px 24px;
      font-size:1rem;
      line-height:1.5;
      text-align:center;
      max-width:80%;
      box-shadow:0 3px 15px rgba(0,0,0,0.25);
      font-family:"Times New Roman","Imperial",serif;
    }

    /* Pulsante "Installa" per browser compatibili */
    #installButton {
      margin-top:20px;
      background:#e0f0ff;
      border:1px solid #000;
      border-radius:10px;
      padding:10px 18px;
      font-size:0.9rem;
      cursor:pointer;
      display:none;
    }

  </style>
</head>

<body>
  <!-- Logo -->
  <picture>
    <source srcset="/images/artbooms-logo.webp" type="image/webp">
    <img id="logo" src="/images/artbooms-logo.jpg" alt="ARTBOOMS logo">
  </picture>

  <!-- Prima nuvoletta -->
  <div id="bubble1" class="bubble">
    <span>Per installare l’app<br><b>tocca il pulsante di condivisione qui sotto ⬇️</b></span>
  </div>

  <!-- Pulsante "Condividi" (solo decorativo) -->
  <div id="shareButton" aria-label="Condividi">
    <svg viewBox="0 0 24 24" fill="none" stroke="#0a84ff" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
      <path d="M12 3v10"></path>
      <path d="M8.5 6.5 12 3l3.5 3.5"></path>
      <rect x="4" y="11" width="16" height="10" rx="2.5" ry="2.5"></rect>
    </svg>
  </div>

  <!-- Overlay testuale (nuova guida) -->
  <div id="overlayHint">
    <div class="hint-box">
      Nel menù che si apre ora,<br>scegli <b>Aggiungi alla schermata Home</b>.
    </div>
  </div>

  <!-- Pulsante di installazione diretto (per Chrome/Edge) -->
  <button id="installButton">Installa ARTBOOMS</button>

  <script>
    // Registra il Service Worker
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').catch(console.error);
    }

    let deferredPrompt;

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      document.getElementById('installButton').style.display = 'inline-block';
    });

    document.getElementById('installButton').addEventListener('click', async () => {
      if (!deferredPrompt) return;
      deferredPrompt.prompt();
      const { outcome } = await deferredPrompt.userChoice;
      console.log(`Scelta utente: ${outcome}`);
      deferredPrompt = null;
      document.getElementById('installButton').style.display = 'none';
    });

    window.addEventListener('load', () => {
      const ua = navigator.userAgent;
      const isiOS = /iphone|ipad|ipod/i.test(ua);
      const isSafari = /safari/i.test(ua) && !/crios|fxios|edgios/i.test(ua);

      const bubble1 = document.getElementById('bubble1');
      const shareButton = document.getElementById('shareButton');
      const overlayHint = document.getElementById('overlayHint');

      if (isiOS && isSafari) {
        // Mostra la prima nuvoletta
        bubble1.style.display = 'block';
        shareButton.style.display = 'block';

        // Dopo 5s mostra il messaggio centrale (invece della seconda nuvoletta)
        setTimeout(() => {
          bubble1.style.display = 'none';
          overlayHint.style.display = 'flex';
          setTimeout(() => { overlayHint.style.display = 'none'; }, 2500);
        }, 5000);
      } else {
        // Android e Desktop -> nessuna guida, solo installButton
        bubble1.style.display = 'none';
        shareButton.style.display = 'none';
        overlayHint.style.display = 'none';
      }
    });
  </script>
</body>
</html>
